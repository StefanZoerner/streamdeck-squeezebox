<head>
    <meta charset="utf-8" />
    <title>Squeezebox</title>
    <link rel="stylesheet" href="css/sdpi.css">
</head>

<body>
    <div class="sdpi-wrapper">

        <div class="sdpi-item">
            <div class="sdpi-item-label">Server Hostname</div>
            <input class="sdpi-item-value" id="hostname" value="" onchange="sendSettingsToPlugin()" >
        </div>

        <div class="sdpi-item">
            <div class="sdpi-item-label">Server Port</div>
            <input class="sdpi-item-value" id="port" value="" onchange="sendSettingsToPlugin()">
        </div>

        <div class="sdpi-item">
            <div class="sdpi-item-label">Player ID</div>
            <input class="sdpi-item-value" id="player_id" value="" onchange="sendSettingsToPlugin()">
        </div>

        <div class="sdpi-item">
            <div class="sdpi-item-label">Information</div>
            <input class="sdpi-item-value" id="debug_info" value="" readonly >
        </div>


    </div>

    <script>
        var websocket = null,
            uuid = null,
            actionInfo = {};

        function connectElgatoStreamDeckSocket(inPort, inPropertyInspectorUUID, inRegisterEvent, inInfo, inActionInfo) {

            uuid = inPropertyInspectorUUID;
            actionInfo = JSON.parse(inActionInfo); // cache the info

            document.getElementById('debug_info').value = inActionInfo;
            populateFormFromActionInfo(inActionInfo)

            websocket = new WebSocket("ws://localhost:" + inPort);
            websocket.onopen = function() {
                // WebSocket is connected, register the Property Inspector
                var json = {
                    "event": inRegisterEvent,
                    "uuid": inPropertyInspectorUUID
                };

                websocket.send(JSON.stringify(json));
            };
        }

        function populateFormFromActionInfo(actionInfo) {
            const obj = JSON.parse(actionInfo);
            document.getElementById('hostname').value = obj.payload.settings.hostname;
            document.getElementById('port').value = obj.payload.settings.port;
            document.getElementById('player_id').value = obj.payload.settings.player_id;
        }

        function sendSettingsToPlugin() {
            if (websocket) {

                settings = {
                    "hostname": document.getElementById('hostname').value,
                    "port": document.getElementById('port').value,
                    "player_id" : document.getElementById('player_id').value
                }

                websocket.send(JSON.stringify({
                    "action": actionInfo['action'],
                    "event": "sendToPlugin",
                    "context": uuid,
                    "payload": settings
                }));
            }
        }

    </script>
</body>